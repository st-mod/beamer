var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{mH:()=>c,Wi:()=>L,h0:()=>S,oL:()=>b,Kl:()=>k,_R:()=>r});const n=["download","href","hreflang","ping","referrerpolicy","rel","target","type"];function o(e){for(const t of e.querySelectorAll("a")){const e=document.createElement("span");for(const{name:o,value:i}of t.attributes)if(!n.includes(o))try{e.setAttribute(o,i)}catch(e){console.log(e)}for(const n of t.childNodes)e.append(n);t.replaceWith(e)}return e}function i(e){const t=[];for(const n of e.trim().split(/\s+/))if(/^\d+-$/.test(n))t[Number(n.slice(0,-1))-1]=!0;else if(/^\d+$/.test(n)){const e=Number(n);t[e-1]=!0,t[e]=void 0}else if(/^\d+-\d+$/.test(n)){const[e,o]=n.split("-",2).map(Number);for(let n=e-1;n<o;n++)t[n]=!0;t[o]=void 0}else if(/^-\d+$/.test(n)){const e=Number(n.slice(1));for(let n=0;n<e;n++)t[n]=!0;t[e]=void 0}return t}function r(e){const t=[],n=[];for(const[,o,i]of e.matchAll(/((?:\^?-?[_a-zA-Z]+[_a-zA-Z0-9-]*\s+)*)([0-9-][0-9-\s]*)(?:\s+|$)/g))t.push(o),n.push(i);const o=function(e){if(0===e.length)return[];const t=e.map(i),n=Math.max(...t.map((e=>e.length)));if(0===n)return[];for(const e of t)if(e.length<n){const t=e[e.length-1];for(let o=e.length;o<n;o++)e[o]=t}return t}(n);if(0===o.length)return[];const r=o[0].length,c=[];for(let e=0;e<r;e++)c[e]=[];for(let e=0;e<o.length;e++){const n=o[e],i=t[e],r=[],s=[];for(const e of i.trim().split(/\s+/)){if(0===e.length){s.push("invisible");break}e.startsWith("^")?s.push(e.slice(1)):r.push(e)}for(let e=0;e<n.length;e++)n[e]?c[e].push(...r):c[e].push(...s)}return c}function c(e){const t=[];for(const n of e.querySelectorAll("[data-slide]")){const e=n.getAttribute("data-slide");if(null===e)continue;const o=r(e);o.length>0&&t.push({element:n,classesArray:o})}return t}function s(e,t){for(;;){for(;null!==e.nextSibling;)e.nextSibling.remove();if(null===e.parentNode||e.parentNode===t)break;e=e.parentNode}}function l(e,t){for(const n of t)for(const t of n){if("string"==typeof t)continue;if(t.tag===e)return t;for(const n of Object.keys(t.options)){const o=t.options[n];if("object"==typeof o){const t=l(e,o);if(void 0!==t)return t}}const n=l(e,t.children);if(void 0!==n)return n}}function a(e,t){const n=[];for(const o of t)for(const t of o)if("string"!=typeof t){t.tag===e&&n.push(t);for(const o of Object.keys(t.options)){const i=t.options[o];"object"==typeof i&&n.push(...a(e,i))}n.push(...a(e,t.children))}return n}function d(e,t){for(const n of e)if(t.base.lineToInlinePlainString(n).length>0)return n;return[]}function p(e){return e.endsWith("px")?Number(e.slice(0,-2)):e.endsWith("cm")?96*Number(e.slice(0,-2))/2.54:e.endsWith("mm")?96*Number(e.slice(0,-2))/25.4:e.endsWith("in")?96*Number(e.slice(0,-2)):e.endsWith("pc")?16*Number(e.slice(0,-2)):e.endsWith("pt")?4*Number(e.slice(0,-2))/3:NaN}const f=[];let u=0;const m=[];let h=-1;function g(e){u===e&&-1!==h||(m[++h]=u=e,m[h+1]=void 0),f[u].scrollIntoView()}let v=!1;function b(){addEventListener("keydown",(e=>{if(0!==f.length)if("Enter"!==e.key){if(v)return"Escape"===e.key?(v=!1,document.documentElement.classList.remove("showing"),void g(u)):"ArrowUp"===e.key||"PageUp"===e.key?(e.preventDefault(),void g((u-1+f.length)%f.length)):"ArrowDown"===e.key||"PageDown"===e.key?(e.preventDefault(),void g((u+1)%f.length)):"ArrowLeft"===e.key?(e.preventDefault(),void function(){let e=m[h-1];void 0!==e&&(u=e,h--,f[u].scrollIntoView())}()):"ArrowRight"===e.key?(e.preventDefault(),void function(){let e=m[h+1];void 0!==e&&(u=e,h++,f[u].scrollIntoView())}()):void 0}else!function(){for(let e=0;e<f.length;e++){const{top:t,height:n}=f[e].getBoundingClientRect();if(t+n/2>=0){document.documentElement.classList.add("showing"),g(e),v=!0;break}}}()})),addEventListener("scroll",(()=>{v&&function(){for(let e=0;e<f.length;e++){const{bottom:t}=f[e].getBoundingClientRect();if(t>1){g(e);break}}}()}))}let y=1920,w=1080,E=!1;function x(e){if(e.endsWith(" landscape")){x(e.slice(0,-10).trim());const t=y;return y=w,void(w=t)}if(e.endsWith(" portrait"))return void x(e.slice(0,-9).trim());if("A5"===e)return y=p("148mm"),void(w=p("210mm"));if("A4"===e)return y=p("210mm"),void(w=p("297mm"));if("A3"===e)return y=p("297mm"),void(w=p("420mm"));if("B5"===e)return y=p("176mm"),void(w=p("250mm"));if("B4"===e)return y=p("250mm"),void(w=p("353mm"));if("JIS-B5"===e)return y=p("182mm"),void(w=p("257mm"));if("JIS-B4"===e)return y=p("257mm"),void(w=p("364mm"));if("letter"===e)return y=p("8.5in"),void(w=p("11in"));if("legal"===e)return y=p("8.5in"),void(w=p("14in"));if("ledger"===e)return y=p("11in"),void(w=p("17in"));const[t,n]=e.trim().split(/\s+/,2).map(p);if(isFinite(t)&&t>0){if(y=t,void 0===n)return void(w=t);isFinite(n)&&n>0&&(w=n)}}function A(e){if("string"!=typeof e)return;const t=document.createElement("style");document.head.append(t),x(e),t.textContent=`@page{size:${y}px ${w}px}.unit.frame>svg>foreignObject>div{height:${w}px}.unit.frame .unit.outline.compact{max-height:${7*w/9}px}`}const N=new Map,L=async(e,t)=>{E||(E=!0,A(t.extractor.extractLastGlobalOption("size","frame",t.context.tagToGlobalOptions)));let n=N.get(t);void 0===n&&N.set(t,n={author:[],page:0});const o=l("title",e.children);void 0!==o&&(n.title=o);const i=a("author",e.children);i.length>0&&(n.author=i);const r=l("date",e.children);void 0!==r&&(n.date=r),n.page++;const p=document.createElement("div");for(let o=0;;o++){const i=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=document.createElementNS("http://www.w3.org/2000/svg","foreignObject"),l=document.createElement("div"),a=document.createElement("main"),u=document.createElement("footer"),m=document.createElement("div"),h=document.createElement("div"),g=document.createElement("div"),v=document.createElement("div");i.setAttribute("viewBox",`0 0 ${y} ${w}`),r.setAttribute("width","100%"),r.setAttribute("height","100%"),p.append(i),i.append(r),r.append(l),l.append(a),l.append(u),a.append(await t.compileSTDN(e.children)),u.append(m),u.append(h),u.append(g),u.append(v),f.push(i);for(const e of n.author){const n=document.createElement("span"),{abbr:o}=e.options;"string"==typeof o?n.append(new Text(o)):"object"==typeof o?n.append(await t.compileLine(d(o,t))):n.append(await t.compileLine(d(e.children,t))),m.append(n)}if(void 0!==n.title){const{abbr:e}=n.title.options;"string"==typeof e?h.append(new Text(e)):"object"==typeof e?h.append(await t.compileLine(d(e,t))):h.append(await t.compileLine(d(n.title.children,t)))}if(void 0!==n.date){const{abbr:e}=n.date.options;"string"==typeof e?g.append(new Text(e)):"object"==typeof e?g.append(await t.compileLine(d(e,t))):g.append(await t.compileLine(d(n.date.children,t)))}v.textContent=n.page.toString();let b=!1;const E=a.querySelectorAll(".unit.pause")[o];void 0!==E&&(s(E,a),b=!0);for(const{element:e,classesArray:t}of c(a))o<t.length-1&&(b=!0),e.classList.add(...t[Math.min(o,t.length-1)]);if(!b)break}return p},k=async(e,t)=>{const n=!0===e.options.pause,i=document.createElement("ul");let r,c=0,s=0;for(const e of t.context.indexInfoArray){if("heading"!==e.orbit||e.index.length>2)continue;const l=document.createElement("li"),a=document.createElement("a");l.append(a),a.append(o(await t.compileLine(d(e.unit.children,t)))),a.href=`#${encodeURIComponent(e.id)}`,2!==e.index.length?(r=document.createElement("ul"),i.append(l),l.append(r),c++,s++,n&&c>1&&(l.dataset.slide=`${c}-`)):void 0!==r&&(r.append(l),s++)}return s>12&&i.classList.add("compact"),s>24&&i.classList.add("very-compact"),i},S=async(e,t)=>{const n=document.createElement("h1");return n.append(await t.compileSTDN(e.children)),n};var $=t.mH,W=t.Wi,j=t.h0,O=t.oL,D=t.Kl,I=t._R;export{$ as extractSlidableElements,W as frame,j as h0,O as listen,D as outline,I as parseSlideStr};